# P波脉冲拾取GUI系统 (P-Pulse Picker)

## 1. 项目概述

P-Pulse Picker 是一个为地震学研究设计的图形用户界面（GUI）工具，专注于P波脉冲的精确拾取与分析。它旨在通过结合高效的批量处理能力、灵活的手动交互功能以及智能的自动检测算法，简化并加速地震波形数据的处理流程。

本系统适用于多种地震学研究场景，包括P波初动分析、震源参数估算、地震能量释放特征研究以及地震预警系统的数据预处理等。

## 2. 功能特性

- **批量数据处理**: 支持一次性加载包含多个地震事件的整个目录树（SAC格式）。
- **交互式波形显示**:
    - 主窗口显示三分量（Z, N, E）波形。
    - 支持通过拖拽选择，创建任意数量的独立放大窗口。
    - 丰富的交互操作：滚轮缩放、中键平移、双击复位。
- **精确手动拾取**:
    - `鼠标左键`: 拾取脉冲**结束**时间。
    - `鼠标右键`: 拾取P波**初动**时间。
    - `Ctrl + 左键`: 拾取脉冲**起始**时间。
- **自动算法辅助**:
    - 内置P波脉冲自动检测算法，可识别脉冲起始、结束、峰值和极性。
    - 算法参数（如阈值、搜索窗口）可配置。
- **结果管理与导出**:
    - 拾取结果在图上实时可视化。
    - 支持将拾取参数导出为 CSV 文件。
    - 支持将拾取信息写回 SAC 文件头。
    - 支持将波形图导出为 PNG/PDF 图像。

## 3. 界面布局与操作

### 主界面
```
┌─────────────────────────────────────────────────────┐
│ 菜单栏：文件 编辑 视图 工具 帮助                      │
├─────────────────────────────────────────────────────┤
│ 工具栏：[打开] [保存] [自动拾取] [手动模式] [设置]    │
├─────────────┬───────────────────────────────────────┤
│ 文件树      │          主波形显示区域                │
│ ├─事件1     │                                       │
│ │ ├─台站A   │          [三分量波形图]               │
│ │ ├─台站B   │                                       │
│ │ └─台站C   │                                       │
│ └─事件2     │                                       │
│   ├─台站A   ├───────────────────────────────────────┤
│   └─台站B   │          放大窗口区域                 │
│             │ [放大窗口1] [放大窗口2] [+新建]       │
│             ├───────────────────────────────────────┤
│             │          参数显示面板                 │
│             │ P到时: _____ 脉冲起始: _____          │
│             │ 脉冲结束: ___ 脉冲面积: _____         │
└─────────────┴───────────────────────────────────────┘
```

### 鼠标操作
```
┌─────────────────────────────────┐
│ 鼠标操作说明：                   │
│ • 左键点击：拾取脉冲结束时间      │
│ • 右键点击：拾取P波初动时间       │
│ • Ctrl+左键：拾取脉冲起始时间     │
│ • 拖拽选择：创建放大窗口         │
│ • 滚轮：缩放时间轴               │
│ • 中键拖拽：平移时间窗口         │
└─────────────────────────────────┘
```

## 4. 技术栈

- **语言**: Python 3
- **GUI框架**: PyQt6
- **数据处理**: ObsPy, NumPy, SciPy
- **绘图**: Matplotlib

## 5. 安装与运行

### 5.1 环境安装
首先，克隆本仓库，然后使用pip安装所需依赖：
```bash
# (建议在虚拟环境中)
pip install -r requirements.txt
```

### 5.2 运行程序
```bash
python src/main.py
```

## 6. 数据结构

系统期望的数据目录结构如下：
```
/path/to/your/data/
  ├─ 20161110030629.440/  (事件目录)
  │  ├─ 5B.1107.DHZ.SAC
  │  ├─ 5B.1107.DHN.SAC
  │  └─ 5B.1107.DHE.SAC
  ├─ 20180101120000.000/
  │  └─ ...
  └─ ...
``` 